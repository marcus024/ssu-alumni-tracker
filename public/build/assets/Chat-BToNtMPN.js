import{r as a,j as e,H as C,a as M}from"./app-Bn14kqFZ.js";import{G as E}from"./GraduateLayout-CAvruFTw.js";function R({conversations:v,graduate:u}){const[i,w]=a.useState(v),[n,k]=a.useState(null),[h,c]=a.useState([]),[l,x]=a.useState(""),[m,f]=a.useState(!1),y=a.useRef(null),N=()=>{y.current?.scrollIntoView({behavior:"smooth"})};a.useEffect(()=>{N()},[h]);const b=async r=>{try{const o=await(await fetch(`/graduate/chat/${encodeURIComponent(r)}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).json();c(o.messages),k(r),w(d=>d.map(s=>s.sender_email===r?{...s,unread_count:0}:s))}catch(t){console.error("Error loading conversation:",t)}},p=r=>{if(r.preventDefault(),!l.trim()||!n||m)return;const t=l,o=n,d={id:Date.now(),sender_name:u.name,sender_email:u.email,message:t,is_from_graduate:!0,created_at:new Date().toISOString()};c(s=>[...s,d]),x(""),f(!0),M.post("/graduate/chat/reply",{sender_email:o,message:t},{preserveScroll:!0,preserveState:!0,only:[],onSuccess:()=>{b(o)},onError:s=>{console.error("Error sending reply:",s),c(_=>_.filter(S=>S.id!==d.id)),x(t)},onFinish:()=>{f(!1)}})},j=r=>{const t=new Date(r);return(new Date().getTime()-t.getTime())/(1e3*60*60)<24?t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString("en-US",{month:"short",day:"numeric"})},g=i.find(r=>r.sender_email===n);return e.jsxs(E,{header:"Messages",children:[e.jsx(C,{title:"Messages"}),e.jsxs("div",{className:"flex h-[calc(100vh-180px)] bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"w-1/3 border-r border-gray-200 dark:border-gray-700 overflow-y-auto",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Conversations"})}),i.length>0?e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:i.map(r=>e.jsxs("button",{onClick:()=>b(r.sender_email),className:`w-full p-4 text-left hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors ${n===r.sender_email?"bg-blue-50 dark:bg-blue-900/20":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:r.sender_name}),r.unread_count>0&&e.jsx("span",{className:"bg-blue-600 text-white text-xs font-bold rounded-full px-2 py-1",children:r.unread_count})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:r.sender_email}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:j(r.last_message_at)})]},r.sender_email))}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500 dark:text-gray-400",children:[e.jsx("svg",{className:"w-16 h-16 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("p",{children:"No messages yet"})]})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:n&&g?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:g.sender_name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:g.sender_email})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[h.map(r=>e.jsx("div",{className:`flex ${r.is_from_graduate?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[70%] rounded-lg p-3 ${r.is_from_graduate?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white"}`,children:[!r.is_from_graduate&&e.jsx("p",{className:"text-xs font-semibold mb-1 text-gray-600 dark:text-gray-400",children:r.sender_name}),e.jsx("p",{className:"whitespace-pre-wrap",children:r.message}),e.jsx("p",{className:`text-xs mt-1 ${r.is_from_graduate?"text-blue-200":"text-gray-500 dark:text-gray-400"}`,children:j(r.created_at)})]})},r.id)),e.jsx("div",{ref:y})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("form",{onSubmit:p,className:"flex space-x-2",children:[e.jsx("textarea",{value:l,onChange:r=>x(r.target.value),onKeyDown:r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),p(r))},placeholder:"Type your reply... (Press Enter to send, Shift+Enter for new line)",rows:2,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white resize-none"}),e.jsx("button",{type:"submit",disabled:m||!l.trim(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed transition-colors",children:m?"Sending...":"Send"})]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500 dark:text-gray-400",children:[e.jsx("svg",{className:"w-20 h-20 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("p",{className:"text-lg",children:"Select a conversation to view messages"})]})})]})]})}export{R as default};
