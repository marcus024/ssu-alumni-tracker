import{r as a,j as e,H as C}from"./app-_PASG3LL.js";import{G as M}from"./GraduateLayout-CpyQvFbo.js";function D({conversations:k,graduate:h}){const[l,v]=a.useState(k),[n,N]=a.useState(null),[u,c]=a.useState([]),[i,m]=a.useState(""),[x,f]=a.useState(!1),y=a.useRef(null),_=()=>{y.current?.scrollIntoView({behavior:"smooth"})};a.useEffect(()=>{_()},[u]);const p=async t=>{try{const o=await(await fetch(`/graduate/chat/${encodeURIComponent(t)}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).json();c(o.messages),N(t),v(d=>d.map(s=>s.sender_email===t?{...s,unread_count:0}:s))}catch(r){console.error("Error loading conversation:",r)}},b=async t=>{if(t.preventDefault(),!i.trim()||!n||x)return;const r=i,o=n,d={id:Date.now(),sender_name:h.name,sender_email:h.email,message:r,is_from_graduate:!0,created_at:new Date().toISOString()};c(s=>[...s,d]),m(""),f(!0);try{const s=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"";if(!(await fetch("/graduate/chat/reply",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":s,Accept:"application/json"},body:JSON.stringify({sender_email:o,message:r})})).ok)throw new Error("Failed to send message");p(o)}catch(s){console.error("Error sending reply:",s),c(w=>w.filter(S=>S.id!==d.id)),m(r),alert("Failed to send message. Please try again.")}finally{f(!1)}},j=t=>{const r=new Date(t);return(new Date().getTime()-r.getTime())/(1e3*60*60)<24?r.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):r.toLocaleDateString("en-US",{month:"short",day:"numeric"})},g=l.find(t=>t.sender_email===n);return e.jsxs(M,{header:"Messages",children:[e.jsx(C,{title:"Messages"}),e.jsxs("div",{className:"flex h-[calc(100vh-180px)] bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"w-1/3 border-r border-gray-200 dark:border-gray-700 overflow-y-auto",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Conversations"})}),l.length>0?e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:l.map(t=>e.jsxs("button",{onClick:()=>p(t.sender_email),className:`w-full p-4 text-left hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors ${n===t.sender_email?"bg-blue-50 dark:bg-blue-900/20":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:t.sender_name}),t.unread_count>0&&e.jsx("span",{className:"bg-blue-600 text-white text-xs font-bold rounded-full px-2 py-1",children:t.unread_count})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:t.sender_email}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:j(t.last_message_at)})]},t.sender_email))}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500 dark:text-gray-400",children:[e.jsx("svg",{className:"w-16 h-16 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("p",{children:"No messages yet"})]})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:n&&g?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:g.sender_name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:g.sender_email})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[u.map(t=>e.jsx("div",{className:`flex ${t.is_from_graduate?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[70%] rounded-lg p-3 ${t.is_from_graduate?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white"}`,children:[!t.is_from_graduate&&e.jsx("p",{className:"text-xs font-semibold mb-1 text-gray-600 dark:text-gray-400",children:t.sender_name}),e.jsx("p",{className:"whitespace-pre-wrap",children:t.message}),e.jsx("p",{className:`text-xs mt-1 ${t.is_from_graduate?"text-blue-200":"text-gray-500 dark:text-gray-400"}`,children:j(t.created_at)})]})},t.id)),e.jsx("div",{ref:y})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("form",{onSubmit:b,className:"flex space-x-2",children:[e.jsx("textarea",{value:i,onChange:t=>m(t.target.value),onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),b(t))},placeholder:"Type your reply... (Press Enter to send, Shift+Enter for new line)",rows:2,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white resize-none"}),e.jsx("button",{type:"submit",disabled:x||!i.trim(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed transition-colors",children:x?"Sending...":"Send"})]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500 dark:text-gray-400",children:[e.jsx("svg",{className:"w-20 h-20 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("p",{className:"text-lg",children:"Select a conversation to view messages"})]})})]})]})}export{D as default};
